# Grafana Helm Chart Values
# https://github.com/grafana/helm-charts/tree/main/charts/grafana

# Persistence configuration
persistence:
  enabled: true
  type: pvc
  size: 10Gi
  accessMode: ReadWriteOnce

# Ingress configuration
ingress:
  enabled: true
  ingressClassName: public
  path: /grafana-flux
  pathType: Prefix
  hosts:
    - cms.geddes.rcac.purdue.edu
  # tls:
  #   - secretName: grafana-tls
  #     hosts:
  #       - cms.geddes.rcac.purdue.edu

# Service configuration
service:
  type: ClusterIP
  port: 80
  targetPort: 3000

# Security context
securityContext:
  runAsNonRoot: true
  runAsUser: 472
  fsGroup: 472

# Resources
resources:
  limits:
    cpu: 200m
    memory: 200Mi
  requests:
    cpu: 100m
    memory: 100Mi

# Grafana configuration
grafana.ini:
  server:
    root_url: https://cms.geddes.rcac.purdue.edu/grafana-flux
    serve_from_sub_path: true
  auth.anonymous:
    enabled: true
    org_name: Main Org.
    org_role: Viewer
    hide_version: true
  users:
    allow_sign_up: false
  security:
    allow_embedding: true

# Dashboard and datasource provisioning
dashboardProviders:
  dashboardproviders.yaml:
    apiVersion: 1
    providers:
      - name: "default"
        orgId: 1
        folder: ""
        type: file
        disableDeletion: false
        updateIntervalSeconds: 10
        allowUiUpdates: true
        options:
          path: /var/lib/grafana/dashboards/default

# Use ConfigMap for dashboards
dashboardsConfigMaps:
  default: grafana-dashboards

# Set default dashboard
dashboards:
  default:
    default-dashboard:
      file: default.json
      editable: true
      options:
        home: true

datasources:
  datasources.yaml:
    apiVersion: 1
    datasources:
      - name: prometheus
        type: prometheus
        url: https://prometheus-af.geddes.rcac.purdue.edu:443
        access: proxy
        isDefault: true
      - name: prometheus-rancher
        type: prometheus
        url: http://rancher-monitoring-prometheus.cattle-monitoring-system:9090
        access: proxy
        isDefault: false
